import sys
sys.path.append("..")
import numpy as np
from osc import square, noise
from env import adsr
from biquad import biquad_filter
from window import hanning_window
from effect import compressor
from instruments.utils import calc_freq, calc_delayar
from typing import Callable, Any


def abstract_bow_string(note_no: int, velocity: int, gate: float, duration: float, f_lpf: float, f_hpf: float, sr: int) -> np.ndarray:
    freq: float = calc_freq(note_no)
    n_partial: int = int(np.clip(6000/freq, 5, 30))

    ratio: float = calc_delayar(offsets=note_no, p1=69, p2=0.02, p3=70/12, p4=0.18, is_sub=True)
    vib_depth: float = calc_freq(note_no + ratio) - freq
    vib: np.ndarray = vib_depth * np.sin(2 * np.pi * 8 * np.arange(int(duration*sr)) / sr)
    fluc: np.ndarray = biquad_filter(noise(sec=duration, sr=sr), filter_type="lowpass", fc=8, Q=1/np.sqrt(2), sr=sr)
    fluc = 0.5 * vib_depth / np.max(np.abs(fluc)) * fluc
    vcf: np.ndarray = (freq + vib + fluc) * np.arange(1, n_partial+1).reshape(-1, 1)

    v: np.ndarray = biquad_filter(noise(sec=duration, sr=sr), filter_type="lowpass", fc=f_lpf, Q=1/np.sqrt(2), sr=sr)
    v = biquad_filter(v, filter_type="lowpass", fc=f_lpf, Q=1/np.sqrt(2), sr=sr)
    v = biquad_filter(v, filter_type="highpass", fc=f_hpf, Q=1/np.sqrt(2), sr=sr)
    v = biquad_filter(v, filter_type="highpass", fc=f_hpf, Q=1/np.sqrt(2), sr=sr)

    y: np.ndarray = np.zeros(int(duration * sr))
    for i in range(n_partial):
        x: np.ndarray = biquad_filter(v, filter_type="bandpass", fc=vcf[i], Q=200, sr=sr)
        y += biquad_filter(x, filter_type="bandpass", fc=vcf[i], Q=200, sr=sr)
    y *= adsr(A=0.2, D=0, S=1, R=0.4, gate=gate, dur=duration, sr=sr)
    return (velocity / 127) / np.max(np.abs(y)) * y


def violin(note_no: int, velocity: int, gate: float, duration: float, sr: int =44100) -> np.ndarray:
    return abstract_bow_string(
        note_no=note_no, velocity=velocity, gate=gate, duration=duration, f_lpf=2000, f_hpf=250, sr=sr
    )


def viola(note_no: int, velocity: int, gate: float, duration: float, sr: int =44100) -> np.ndarray:
    return abstract_bow_string(
        note_no=note_no, velocity=velocity, gate=gate, duration=duration, f_lpf=1400, f_hpf=200, sr=sr
    )


def cello(note_no: int, velocity: int, gate: float, duration: float, sr: int =44100) -> np.ndarray:
    return abstract_bow_string(
        note_no=note_no, velocity=velocity, gate=gate, duration=duration, f_lpf=900, f_hpf=150, sr=sr
    )


def contrabass(note_no: int, velocity: int, gate: float, duration: float, sr: int =44100) -> np.ndarray:
    return abstract_bow_string(
        note_no=note_no, velocity=velocity, gate=gate, duration=duration, f_lpf=500, f_hpf=100, sr=sr
    )


def plucked_string_excitation(freq: float, n: int, duration: float, sr: int) -> np.ndarray:
    z: np.ndarray = np.zeros(int(duration*sr))
    n_partial: int = int(20000 / freq)
    for i in range(n_partial):
        z[:n+1] += np.sin(
            2 * np.pi * freq * (i+1) * np.arange(n+1) / sr + 2 * (np.random.default_rng().random() - 0.5) * np.pi
        )
    return z - np.mean(z)

def plucked_string_delay_feedback(z: np.ndarray, win_len: int, n_delay: int, apf_coef: float, c: float, d: float, duration: float, sr: int) -> np.ndarray:
    fdelays: np.ndarray = np.zeros(int(duration*sr))
    for i in range(n_delay+1+win_len, int(duration*sr)):
        fdelays[i] = - apf_coef * fdelays[i-1] + apf_coef * z[i-n_delay] + z[i-n_delay-1]
        z[i] += c * ((1 - d) * fdelays[i] + d * fdelays[i-1])
    return z

def plucked_string_comb_filter(z: np.ndarray, freq: float, pos: float, n_delay: int, duration: float, sr: int) -> np.ndarray:
    u: np.ndarray = np.zeros(int(duration*sr))
    for i in range(int(duration*sr)):
        idx: float = i - pos * sr / freq
        idx_int: int = int(idx)
        idx_frac: float = idx - idx_int
        if idx_int < 0:
            u[i] = z[i] - (idx_frac * z[idx_int+1+n_delay+1] + (1 - idx_frac) * z[idx_int+n_delay+1])
        else:
            u[i] = z[i] - (idx_frac * z[idx_int+1] + (1 - idx_frac) * z[idx_int])
    return u

def plucked_string_frequency_filter(z: np.ndarray, note_no: int, lowest_note_no: int, n_fft: int, n_band: int, win_len: int,
                                    amps: np.ndarray, freqs: np.ndarray, duration: float, sr: int) -> np.ndarray:
    H: np.ndarray = np.zeros(n_fft)
    for band in range(n_band):
        H[freqs[band]:freqs[band+1]] = amps[note_no-lowest_note_no][band]
    ks: np.ndarray = np.arange(1, n_fft//2)
    H[n_fft-ks] = H[ks]
    h: np.ndarray = np.roll(np.real(np.fft.ifft(H, n_fft)), -n_fft//2)
    b: np.ndarray = hanning_window(win_len+1) * h[(n_fft-win_len)//2:(n_fft+win_len)//2+1]

    u = np.zeros(int(duration*sr))
    for i in range(int(duration*sr)):
        for j in range(win_len+1):
            if i - j >= 0:
                u[i] += b[j] * z[i-j]
    z = np.concatenate([u[:int(duration*sr)-win_len], np.zeros(win_len)])

    z = biquad_filter(z, filter_type="highpass", fc=5, Q=1/np.sqrt(2), sr=sr)
    return z / np.max(np.abs(z))

def plucked_string_part(z: np.ndarray, p_vcf: dict[str, float], p_vca: dict[str, float], sr: int) -> np.ndarray:
    vcf: np.ndarray = p_vcf["offset"] \
                    + p_vcf["depth"] * adsr(A=p_vcf["A"], D=p_vcf["D"], S=p_vcf["S"], R=p_vcf["R"], \
                                            gate=p_vcf['gate'], dur=p_vcf['dur'], sr=sr)
    vcf = np.minimum(vcf, 20000)
    vca: np.ndarray = p_vca["offset"] \
                    + p_vca["depth"] * adsr(A=p_vca["A"], D=p_vca["D"], S=p_vca["S"], R=p_vca["R"], \
                                            gate=p_vca['gate'], dur=p_vca['dur'], sr=sr)
    z: np.ndarray = vca * biquad_filter(z, filter_type="lowpass", fc=vcf, Q=1/np.sqrt(2), sr=sr)
    return z


def harp(note_no: int, velocity: int, gate: float, duration: float, sr: int =44100) -> np.ndarray:
    WIN_LEN: int = 128
    freq: float = calc_freq(note_no)

    # feedback filter
    d: float = calc_delayar(note_no, p1=70, p2=0, p3=120/12, p4=0.5, is_sub=True)
    fbk_decay: float = calc_delayar(note_no, p1=75, p2=0, p3=120/12, p4=20, is_sub=True)
    c: float = np.minimum(
        np.power(10, -3/freq/fbk_decay) / np.sqrt((1 - d) ** 2 + 2 * d * (1 - d) * np.cos(2 * np.pi * freq / sr) + d ** 2),
        1
    )

    # delayline
    n_delay: int = int(sr / freq - d)
    f_delay: float = sr / freq - d - n_delay
    apf_coef: float = (1 - f_delay) / (1 + f_delay)

    # Karplus-Strong string synthesis
    pos: float = 0.5
    z = plucked_string_excitation(freq, n_delay+WIN_LEN, duration, sr)
    z = plucked_string_delay_feedback(z, WIN_LEN, n_delay, apf_coef, c, d, duration, sr)
    z = plucked_string_comb_filter(z, freq, pos, n_delay, duration, sr)

    # frequency filtering
    N_FFT: int = 4096
    N_BAND: int = 64
    LOWEST_NOTE_NO: int = 23
    amps: np.ndarray = np.array([
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.995030, 0.982342, 0.960597, 0.934663, 0.899010, 0.852986, 0.801740, 0.741415, 0.673532, 0.605917, 0.535459, 0.464877, 0.401301, 0.341824, 0.288019, 0.241219, 0.201690, 0.169479, 0.143868, 0.124166, 0.109343, 0.098544, 0.090561, 0.084938, 0.080723, 0.076826, 0.072366, 0.066664, 0.059786, 0.052042, 0.044155, 0.037440, 0.032226, 0.028451, 0.025802, 0.023649, 0.021300, 0.018598, 0.016085, 0.014572, 0.014648, 0.016036, 0.017065, 0.015370, 0.011483, 0.008393, 0.007253, 0.007162, 0.006734, 0.006337, 0.007576, 0.009671, 0.008863, 0.006913, 0.006223, 0.005968, 0.008224, 0.008089, 0.003574, 0.003039, 0.001618, 0.001672, 0.001290]
    ])
    freqs: np.ndarray = np.array([
           0,    4,    7,   12,   16,   20,   25,   30,   35,   41,
          47,   53,   60,   67,   74,   82,   90,   99,  108,  118,
         128,  139,  150,  162,  175,  188,  202,  217,  233,  250,
         267,  286,  306,  326,  348,  371,  396,  421,  449,  477,
         508,  540,  574,  609,  647,  687,  729,  773,  820,  869,
         922,  977, 1035, 1097, 1161, 1230, 1302, 1379, 1460, 1545,
        1635, 1730, 1830, 1936, 2048
    ])
    z = plucked_string_frequency_filter(z, note_no, LOWEST_NOTE_NO, N_FFT, N_BAND, WIN_LEN, amps, freqs, duration, sr)

    # parts
    p_vcf_a: dict[str, float] = {'A': 0, 'D': 5/freq, 'S': 0, 'R': 5/freq,
                                 'gate': gate, 'dur': duration, 'offset': 32*freq, 'depth': 512*freq}
    p_vca_a: dict[str, float] = {'A': 4/freq, 'D': 20/freq, 'S': 0, 'R': 20/freq,
                                 'gate': gate, 'dur': duration, 'offset': 0, 'depth': 1}
    za: np.ndarray = plucked_string_part(z, p_vcf_a, p_vca_a, sr)

    p_vcf_s: dict[str, float] = {'A': 0, 'D': 0.2*fbk_decay, 'S': 0, 'R': 0.2*fbk_decay,
                                 'gate': gate, 'dur': duration, 'offset': 8*freq, 'depth': 128*freq}
    p_vca_s: dict[str, float] = {'A': 4/freq, 'D': 0, 'S': 1, 'R': 0,
                                 'gate': duration, 'dur': duration, 'offset': 0, 'depth': 1}
    zs: np.ndarray = plucked_string_part(z, p_vcf_s, p_vca_s, sr)

    vca: np.ndarray = adsr(A=0, D=0, S=1, R=0.1, gate=gate, dur=duration, sr=sr)
    z = vca * (0.5 * za + 0.5 * zs)
    return (velocity / 127) / np.max(np.abs(z)) * z


def acoustic_guitar(note_no: int, velocity: int, gate: float, duration: float, sr: int =44100) -> np.ndarray:
    WIN_LEN: int = 128
    LOWEST_NOTE_NO: int = 40
    freq: float = calc_freq(note_no)

    # feedback filter
    d: float = calc_delayar(note_no, p1=70, p2=0, p3=120/12, p4=0.5, is_sub=True)
    fbk_decay: float = calc_delayar(note_no, p1=60, p2=0, p3=120/12, p4=20, is_sub=True)
    c: float = np.minimum(
        np.power(10, -3/freq/fbk_decay) / np.sqrt((1 - d) ** 2 + 2 * d * (1 - d) * np.cos(2 * np.pi * freq / sr) + d ** 2),
        1
    )

    # delayline
    n_delay: int = int(sr / freq - d)
    f_delay: float = sr / freq - d - n_delay
    apf_coef: float = (1 - f_delay) / (1 + f_delay)

    # Karplus-Strong string synthesis
    excitation: np.ndarray = np.array([
        0.25, 0.25, 0.25, 0.30, 0.30, 0.34, 0.34, 0.34, 0.30, 0.30,
        0.34, 0.34, 0.38, 0.38, 0.38, 0.34, 0.34, 0.38, 0.38, 0.38,
        0.34, 0.34, 0.38, 0.38, 0.43, 0.43, 0.43, 0.40, 0.40, 0.45,
        0.45, 0.45, 0.40, 0.40, 0.45, 0.45, 0.51, 0.51, 0.51, 0.60,
        0.60, 0.68, 0.68, 0.68, 0.81
    ])
    pos: float = excitation[note_no-LOWEST_NOTE_NO]
    z = plucked_string_excitation(freq, n_delay+WIN_LEN, duration, sr)
    z = plucked_string_delay_feedback(z, WIN_LEN, n_delay, apf_coef, c, d, duration, sr)
    z = plucked_string_comb_filter(z, freq, pos, n_delay, duration, sr)

    # frequency filtering
    N_FFT: int = 4096
    N_BAND: int = 64
    amps: np.ndarray = np.array([
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.060858, 0.188249, 0.632011, 1.000000, 0.850353, 0.347937, 0.157694, 0.140827, 0.192228, 0.357717, 0.079275, 0.074854, 0.036400, 0.065630, 0.064848, 0.044823, 0.079304, 0.057037, 0.030086, 0.030348, 0.071365, 0.028947, 0.014450, 0.023485, 0.021666, 0.020902, 0.022189, 0.024348, 0.016225, 0.019122, 0.035220, 0.006662, 0.013261, 0.018244, 0.005799, 0.010833, 0.011369, 0.008764, 0.007319, 0.005925, 0.009274, 0.005687, 0.003852, 0.003488, 0.004024, 0.003406, 0.003140, 0.002878, 0.001997, 0.002213, 0.002079, 0.001446, 0.001384, 0.000878, 0.000447, 0.000510, 0.000274, 0.000247, 0.000164, 0.000228, 0.000244, 0.000227, 0.000281, 0.000261],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.046745, 0.094280, 0.352658, 0.938142, 1.000000, 0.490902, 0.193114, 0.153733, 0.205178, 0.168552, 0.066142, 0.033446, 0.041979, 0.041991, 0.029496, 0.050632, 0.062910, 0.018927, 0.016269, 0.020079, 0.009328, 0.015164, 0.015082, 0.020074, 0.013432, 0.007060, 0.005356, 0.004610, 0.005968, 0.009002, 0.006982, 0.008441, 0.008451, 0.006159, 0.005910, 0.004807, 0.004307, 0.004175, 0.004417, 0.002765, 0.003162, 0.002115, 0.001149, 0.001410, 0.000699, 0.001263, 0.000538, 0.001154, 0.000633, 0.000817, 0.000345, 0.000479, 0.000500, 0.000272, 0.000229, 0.000180, 0.000124, 0.000082, 0.000069, 0.000066, 0.000041, 0.000039, 0.000038, 0.000032],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [0.403562, 0.425674, 0.484043, 0.587428, 0.709932, 0.857886, 0.981276, 1.000000, 0.879080, 0.656411, 0.442764, 0.282952, 0.186616, 0.140537, 0.120961, 0.116027, 0.116218, 0.111837, 0.097189, 0.076798, 0.060819, 0.054040, 0.051387, 0.041287, 0.026989, 0.022066, 0.028222, 0.030414, 0.023646, 0.026973, 0.023235, 0.012258, 0.020054, 0.019121, 0.019388, 0.023615, 0.008311, 0.023909, 0.011396, 0.005976, 0.004115, 0.004502, 0.004226, 0.004772, 0.003377, 0.001722, 0.001412, 0.001079, 0.001299, 0.002012, 0.002120, 0.001042, 0.001323, 0.001474, 0.000733, 0.000376, 0.000353, 0.000283, 0.000262, 0.000250, 0.000183, 0.000209, 0.000165, 0.000161],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.996959, 0.989121, 0.975469, 0.958787, 0.935097, 0.903193, 0.865749, 0.818770, 0.761849, 0.700278, 0.630164, 0.553219, 0.477443, 0.400557, 0.326152, 0.258156, 0.199401, 0.151907, 0.115702, 0.090016, 0.072997, 0.062960, 0.058075, 0.057100, 0.057947, 0.057888, 0.054259, 0.046800, 0.038650, 0.032793, 0.030329, 0.030185, 0.029453, 0.026393, 0.022703, 0.020332, 0.017698, 0.013279, 0.009885, 0.009485, 0.009819, 0.008647, 0.008129, 0.007524, 0.006741, 0.008184, 0.005889, 0.004463, 0.006105, 0.005055, 0.003975, 0.005074, 0.004375, 0.004186, 0.003510, 0.002665, 0.002176, 0.001816, 0.000990, 0.000793, 0.000510, 0.000471, 0.000382],
        [1.000000, 0.995030, 0.982342, 0.960597, 0.934663, 0.899010, 0.852986, 0.801740, 0.741415, 0.673532, 0.605917, 0.535459, 0.464877, 0.401301, 0.341824, 0.288019, 0.241219, 0.201690, 0.169479, 0.143868, 0.124166, 0.109343, 0.098544, 0.090561, 0.084938, 0.080723, 0.076826, 0.072366, 0.066664, 0.059786, 0.052042, 0.044155, 0.037440, 0.032226, 0.028451, 0.025802, 0.023649, 0.021300, 0.018598, 0.016085, 0.014572, 0.014648, 0.016036, 0.017065, 0.015370, 0.011483, 0.008393, 0.007253, 0.007162, 0.006734, 0.006337, 0.007576, 0.009671, 0.008863, 0.006913, 0.006223, 0.005968, 0.008224, 0.008089, 0.003574, 0.003039, 0.001618, 0.001672, 0.001290]
    ])
    freqs: np.ndarray = np.array([
           0,    4,    7,   12,   16,   20,   25,   30,   35,   41,
          47,   53,   60,   67,   74,   82,   90,   99,  108,  118,
         128,  139,  150,  162,  175,  188,  202,  217,  233,  250,
         267,  286,  306,  326,  348,  371,  396,  421,  449,  477,
         508,  540,  574,  609,  647,  687,  729,  773,  820,  869,
         922,  977, 1035, 1097, 1161, 1230, 1302, 1379, 1460, 1545,
        1635, 1730, 1830, 1936, 2048
    ])
    z = plucked_string_frequency_filter(z, note_no, LOWEST_NOTE_NO, N_FFT, N_BAND, WIN_LEN, amps, freqs, duration, sr)

    # parts
    p_vcf_a: dict[str, float] = {'A': 0, 'D': 5/freq, 'S': 0, 'R': 5/freq,
                                 'gate': gate, 'dur': duration, 'offset': 32*freq, 'depth': 512*freq}
    p_vca_a: dict[str, float] = {'A': 1/freq, 'D': 20/freq, 'S': 0, 'R': 20/freq,
                                 'gate': gate, 'dur': duration, 'offset': 0, 'depth': 1}
    za: np.ndarray = plucked_string_part(z, p_vcf_a, p_vca_a, sr)

    p_vcf_s: dict[str, float] = {'A': 0, 'D': 0.2*fbk_decay, 'S': 0, 'R': 0.2*fbk_decay,
                                 'gate': gate, 'dur': duration, 'offset': 8*freq, 'depth': 128*freq}
    p_vca_s: dict[str, float] = {'A': 1/freq, 'D': 0, 'S': 1, 'R': 0,
                                 'gate': duration, 'dur': duration, 'offset': 0, 'depth': 1}
    zs: np.ndarray = plucked_string_part(z, p_vcf_s, p_vca_s, sr)

    vca: np.ndarray = adsr(A=0, D=0, S=1, R=0.1, gate=gate, dur=duration, sr=sr)
    z = vca * (0.5 * za + 0.5 * zs)
    return (velocity / 127) / np.max(np.abs(z)) * z


def electric_guitar(note_no: int, velocity: int, gate: float, duration: float, sr: int =44100,
                    post_effect: Callable[[np.ndarray], np.ndarray]|None =None, **post_effect_kwargs: Any) -> np.ndarray:
    WIN_LEN: int = 128
    LOWEST_NOTE_NO: int = 40
    freq: float = calc_freq(note_no)

    # feedback filter
    d: float = calc_delayar(note_no, p1=50, p2=0, p3=120/12, p4=0.5, is_sub=True)
    fbk_decay: float = calc_delayar(note_no, p1=75, p2=0, p3=120/12, p4=20, is_sub=True)
    c: float = np.minimum(
        np.power(10, -3/freq/fbk_decay) / np.sqrt((1 - d) ** 2 + 2 * d * (1 - d) * np.cos(2 * np.pi * freq / sr) + d ** 2),
        1
    )

    # delayline
    n_delay: int = int(sr / freq - d)
    f_delay: float = sr / freq - d - n_delay
    apf_coef: float = (1 - f_delay) / (1 + f_delay)

    # Karplus-Strong string synthesis
    excitation: np.ndarray = np.array([
        0.15, 0.15, 0.15, 0.18, 0.18, 0.21, 0.21, 0.21, 0.18, 0.18,
        0.21, 0.21, 0.23, 0.23, 0.23, 0.21, 0.21, 0.23, 0.23, 0.23,
        0.21, 0.21, 0.23, 0.23, 0.26, 0.26, 0.26, 0.25, 0.25, 0.28,
        0.28, 0.28, 0.25, 0.25, 0.28, 0.28, 0.31, 0.31, 0.31, 0.37,
        0.37, 0.41, 0.41, 0.41, 0.49, 0.49, 0.55
    ])
    pickup: np.ndarray = np.array([
        0.24, 0.24, 0.24, 0.29, 0.29, 0.33, 0.33, 0.33, 0.29, 0.29,
        0.32, 0.32, 0.36, 0.36, 0.36, 0.32, 0.32, 0.36, 0.36, 0.36,
        0.32, 0.32, 0.36, 0.36, 0.41, 0.41, 0.41, 0.38, 0.38, 0.43,
        0.43, 0.43, 0.38, 0.38, 0.43, 0.43, 0.48, 0.48, 0.48, 0.57,
        0.57, 0.64, 0.64, 0.64, 0.76, 0.76, 0.85
    ])
    z = plucked_string_excitation(freq, n_delay+WIN_LEN, duration, sr)
    z = plucked_string_delay_feedback(z, WIN_LEN, n_delay, apf_coef, c, d, duration, sr)
    z = plucked_string_comb_filter(z, freq, excitation[note_no-LOWEST_NOTE_NO], n_delay, duration, sr)
    z = plucked_string_comb_filter(z, freq, pickup[note_no-LOWEST_NOTE_NO], n_delay, duration, sr)

    # frequency filtering
    N_FFT: int = 4096
    N_BAND: int = 64
    amps: np.ndarray = np.array([
        [0.042870, 0.101982, 0.383088, 0.721357, 0.619579, 0.517834, 0.682021, 0.911216, 1.000000, 0.753317, 0.226584, 0.083716, 0.186115, 0.329012, 0.365911, 0.262354, 0.142569, 0.070802, 0.031780, 0.070772, 0.096276, 0.173273, 0.103871, 0.034668, 0.044158, 0.048280, 0.031350, 0.009431, 0.003140, 0.007009, 0.008527, 0.007561, 0.003104, 0.002762, 0.002116, 0.000914, 0.000418, 0.000672, 0.000656, 0.000603, 0.000430, 0.000327, 0.000258, 0.000233, 0.000316, 0.000300, 0.000318, 0.000387, 0.000273, 0.000382, 0.000367, 0.000315, 0.000293, 0.000299, 0.000233, 0.000237, 0.000252, 0.000317, 0.000270, 0.000246, 0.000313, 0.000249, 0.000324, 0.000240],
        [0.042870, 0.101982, 0.383088, 0.721357, 0.619579, 0.517834, 0.682021, 0.911216, 1.000000, 0.753317, 0.226584, 0.083716, 0.186115, 0.329012, 0.365911, 0.262354, 0.142569, 0.070802, 0.031780, 0.070772, 0.096276, 0.173273, 0.103871, 0.034668, 0.044158, 0.048280, 0.031350, 0.009431, 0.003140, 0.007009, 0.008527, 0.007561, 0.003104, 0.002762, 0.002116, 0.000914, 0.000418, 0.000672, 0.000656, 0.000603, 0.000430, 0.000327, 0.000258, 0.000233, 0.000316, 0.000300, 0.000318, 0.000387, 0.000273, 0.000382, 0.000367, 0.000315, 0.000293, 0.000299, 0.000233, 0.000237, 0.000252, 0.000317, 0.000270, 0.000246, 0.000313, 0.000249, 0.000324, 0.000240],
        [0.042870, 0.101982, 0.383088, 0.721357, 0.619579, 0.517834, 0.682021, 0.911216, 1.000000, 0.753317, 0.226584, 0.083716, 0.186115, 0.329012, 0.365911, 0.262354, 0.142569, 0.070802, 0.031780, 0.070772, 0.096276, 0.173273, 0.103871, 0.034668, 0.044158, 0.048280, 0.031350, 0.009431, 0.003140, 0.007009, 0.008527, 0.007561, 0.003104, 0.002762, 0.002116, 0.000914, 0.000418, 0.000672, 0.000656, 0.000603, 0.000430, 0.000327, 0.000258, 0.000233, 0.000316, 0.000300, 0.000318, 0.000387, 0.000273, 0.000382, 0.000367, 0.000315, 0.000293, 0.000299, 0.000233, 0.000237, 0.000252, 0.000317, 0.000270, 0.000246, 0.000313, 0.000249, 0.000324, 0.000240],
        [0.054300, 0.105990, 0.324088, 0.677615, 0.789725, 0.830218, 1.000000, 0.962970, 0.615219, 0.402590, 0.269681, 0.129646, 0.128123, 0.259391, 0.272515, 0.227278, 0.162283, 0.073320, 0.045457, 0.050562, 0.081528, 0.104925, 0.104746, 0.058594, 0.027504, 0.030928, 0.030534, 0.011119, 0.005028, 0.004784, 0.006618, 0.006413, 0.004054, 0.002720, 0.001708, 0.000815, 0.000513, 0.000637, 0.000776, 0.000639, 0.000453, 0.000385, 0.000270, 0.000252, 0.000253, 0.000263, 0.000235, 0.000232, 0.000199, 0.000245, 0.000259, 0.000239, 0.000258, 0.000233, 0.000217, 0.000232, 0.000225, 0.000222, 0.000233, 0.000256, 0.000201, 0.000223, 0.000220, 0.000199],
        [0.054300, 0.105990, 0.324088, 0.677615, 0.789725, 0.830218, 1.000000, 0.962970, 0.615219, 0.402590, 0.269681, 0.129646, 0.128123, 0.259391, 0.272515, 0.227278, 0.162283, 0.073320, 0.045457, 0.050562, 0.081528, 0.104925, 0.104746, 0.058594, 0.027504, 0.030928, 0.030534, 0.011119, 0.005028, 0.004784, 0.006618, 0.006413, 0.004054, 0.002720, 0.001708, 0.000815, 0.000513, 0.000637, 0.000776, 0.000639, 0.000453, 0.000385, 0.000270, 0.000252, 0.000253, 0.000263, 0.000235, 0.000232, 0.000199, 0.000245, 0.000259, 0.000239, 0.000258, 0.000233, 0.000217, 0.000232, 0.000225, 0.000222, 0.000233, 0.000256, 0.000201, 0.000223, 0.000220, 0.000199],
        [0.069323, 0.127784, 0.388837, 0.886538, 1.000000, 0.721029, 0.533096, 0.576768, 0.730254, 0.766992, 0.554418, 0.250845, 0.119502, 0.150757, 0.223468, 0.190630, 0.148462, 0.071899, 0.042428, 0.047509, 0.056164, 0.094310, 0.098907, 0.106412, 0.044771, 0.029575, 0.025546, 0.015627, 0.004453, 0.008552, 0.006758, 0.007442, 0.008901, 0.004418, 0.002437, 0.001126, 0.000777, 0.001060, 0.000994, 0.000896, 0.000625, 0.000357, 0.000265, 0.000256, 0.000308, 0.000323, 0.000329, 0.000300, 0.000288, 0.000394, 0.000405, 0.000261, 0.000297, 0.000300, 0.000262, 0.000328, 0.000291, 0.000346, 0.000299, 0.000278, 0.000288, 0.000334, 0.000302, 0.000274],
        [0.069323, 0.127784, 0.388837, 0.886538, 1.000000, 0.721029, 0.533096, 0.576768, 0.730254, 0.766992, 0.554418, 0.250845, 0.119502, 0.150757, 0.223468, 0.190630, 0.148462, 0.071899, 0.042428, 0.047509, 0.056164, 0.094310, 0.098907, 0.106412, 0.044771, 0.029575, 0.025546, 0.015627, 0.004453, 0.008552, 0.006758, 0.007442, 0.008901, 0.004418, 0.002437, 0.001126, 0.000777, 0.001060, 0.000994, 0.000896, 0.000625, 0.000357, 0.000265, 0.000256, 0.000308, 0.000323, 0.000329, 0.000300, 0.000288, 0.000394, 0.000405, 0.000261, 0.000297, 0.000300, 0.000262, 0.000328, 0.000291, 0.000346, 0.000299, 0.000278, 0.000288, 0.000334, 0.000302, 0.000274],
        [0.069323, 0.127784, 0.388837, 0.886538, 1.000000, 0.721029, 0.533096, 0.576768, 0.730254, 0.766992, 0.554418, 0.250845, 0.119502, 0.150757, 0.223468, 0.190630, 0.148462, 0.071899, 0.042428, 0.047509, 0.056164, 0.094310, 0.098907, 0.106412, 0.044771, 0.029575, 0.025546, 0.015627, 0.004453, 0.008552, 0.006758, 0.007442, 0.008901, 0.004418, 0.002437, 0.001126, 0.000777, 0.001060, 0.000994, 0.000896, 0.000625, 0.000357, 0.000265, 0.000256, 0.000308, 0.000323, 0.000329, 0.000300, 0.000288, 0.000394, 0.000405, 0.000261, 0.000297, 0.000300, 0.000262, 0.000328, 0.000291, 0.000346, 0.000299, 0.000278, 0.000288, 0.000334, 0.000302, 0.000274],
        [0.061897, 0.098793, 0.253066, 0.620405, 0.945687, 1.000000, 0.902474, 0.876699, 0.794960, 0.530156, 0.359007, 0.403074, 0.436705, 0.207971, 0.095017, 0.198415, 0.442760, 0.321012, 0.239937, 0.237999, 0.143680, 0.046788, 0.026143, 0.057228, 0.106323, 0.146292, 0.182233, 0.093525, 0.090692, 0.087720, 0.054326, 0.023223, 0.008342, 0.006383, 0.010050, 0.008080, 0.003715, 0.004971, 0.003783, 0.002316, 0.001410, 0.001233, 0.001214, 0.001246, 0.001337, 0.001178, 0.001119, 0.000887, 0.001153, 0.001074, 0.000984, 0.001087, 0.001026, 0.000980, 0.000972, 0.000942, 0.000971, 0.001156, 0.001341, 0.000957, 0.001031, 0.001023, 0.001065, 0.001043],
        [0.061897, 0.098793, 0.253066, 0.620405, 0.945687, 1.000000, 0.902474, 0.876699, 0.794960, 0.530156, 0.359007, 0.403074, 0.436705, 0.207971, 0.095017, 0.198415, 0.442760, 0.321012, 0.239937, 0.237999, 0.143680, 0.046788, 0.026143, 0.057228, 0.106323, 0.146292, 0.182233, 0.093525, 0.090692, 0.087720, 0.054326, 0.023223, 0.008342, 0.006383, 0.010050, 0.008080, 0.003715, 0.004971, 0.003783, 0.002316, 0.001410, 0.001233, 0.001214, 0.001246, 0.001337, 0.001178, 0.001119, 0.000887, 0.001153, 0.001074, 0.000984, 0.001087, 0.001026, 0.000980, 0.000972, 0.000942, 0.000971, 0.001156, 0.001341, 0.000957, 0.001031, 0.001023, 0.001065, 0.001043],
        [0.070831, 0.102528, 0.224161, 0.517823, 0.844636, 1.000000, 0.924423, 0.839657, 0.780392, 0.578856, 0.313924, 0.188739, 0.235846, 0.424528, 0.538595, 0.522242, 0.489496, 0.241871, 0.097732, 0.151970, 0.170055, 0.070471, 0.040419, 0.043663, 0.116473, 0.121562, 0.145093, 0.055084, 0.120236, 0.120333, 0.056978, 0.025179, 0.011232, 0.008419, 0.009386, 0.013468, 0.008698, 0.006600, 0.004598, 0.002327, 0.002047, 0.001546, 0.001409, 0.001076, 0.001014, 0.000915, 0.000777, 0.000632, 0.000801, 0.000720, 0.000703, 0.000715, 0.000714, 0.000711, 0.000738, 0.000840, 0.000734, 0.000904, 0.000688, 0.000695, 0.000791, 0.000755, 0.000748, 0.000582],
        [0.070831, 0.102528, 0.224161, 0.517823, 0.844636, 1.000000, 0.924423, 0.839657, 0.780392, 0.578856, 0.313924, 0.188739, 0.235846, 0.424528, 0.538595, 0.522242, 0.489496, 0.241871, 0.097732, 0.151970, 0.170055, 0.070471, 0.040419, 0.043663, 0.116473, 0.121562, 0.145093, 0.055084, 0.120236, 0.120333, 0.056978, 0.025179, 0.011232, 0.008419, 0.009386, 0.013468, 0.008698, 0.006600, 0.004598, 0.002327, 0.002047, 0.001546, 0.001409, 0.001076, 0.001014, 0.000915, 0.000777, 0.000632, 0.000801, 0.000720, 0.000703, 0.000715, 0.000714, 0.000711, 0.000738, 0.000840, 0.000734, 0.000904, 0.000688, 0.000695, 0.000791, 0.000755, 0.000748, 0.000582],
        [0.057182, 0.085669, 0.204396, 0.522172, 0.895461, 1.000000, 0.750502, 0.547408, 0.532535, 0.600159, 0.457677, 0.195968, 0.098102, 0.175152, 0.570444, 0.694612, 0.263477, 0.133772, 0.130286, 0.078095, 0.063962, 0.069637, 0.029247, 0.036537, 0.063628, 0.061631, 0.145079, 0.100616, 0.064500, 0.077850, 0.082886, 0.044382, 0.015918, 0.010283, 0.010186, 0.005648, 0.008424, 0.005655, 0.002271, 0.002565, 0.002019, 0.001571, 0.001926, 0.001891, 0.001633, 0.001741, 0.001422, 0.001330, 0.001070, 0.001426, 0.001113, 0.001254, 0.001234, 0.001651, 0.001267, 0.001218, 0.001446, 0.001416, 0.001321, 0.001296, 0.001326, 0.001262, 0.001094, 0.001230],
        [0.057182, 0.085669, 0.204396, 0.522172, 0.895461, 1.000000, 0.750502, 0.547408, 0.532535, 0.600159, 0.457677, 0.195968, 0.098102, 0.175152, 0.570444, 0.694612, 0.263477, 0.133772, 0.130286, 0.078095, 0.063962, 0.069637, 0.029247, 0.036537, 0.063628, 0.061631, 0.145079, 0.100616, 0.064500, 0.077850, 0.082886, 0.044382, 0.015918, 0.010283, 0.010186, 0.005648, 0.008424, 0.005655, 0.002271, 0.002565, 0.002019, 0.001571, 0.001926, 0.001891, 0.001633, 0.001741, 0.001422, 0.001330, 0.001070, 0.001426, 0.001113, 0.001254, 0.001234, 0.001651, 0.001267, 0.001218, 0.001446, 0.001416, 0.001321, 0.001296, 0.001326, 0.001262, 0.001094, 0.001230],
        [0.057182, 0.085669, 0.204396, 0.522172, 0.895461, 1.000000, 0.750502, 0.547408, 0.532535, 0.600159, 0.457677, 0.195968, 0.098102, 0.175152, 0.570444, 0.694612, 0.263477, 0.133772, 0.130286, 0.078095, 0.063962, 0.069637, 0.029247, 0.036537, 0.063628, 0.061631, 0.145079, 0.100616, 0.064500, 0.077850, 0.082886, 0.044382, 0.015918, 0.010283, 0.010186, 0.005648, 0.008424, 0.005655, 0.002271, 0.002565, 0.002019, 0.001571, 0.001926, 0.001891, 0.001633, 0.001741, 0.001422, 0.001330, 0.001070, 0.001426, 0.001113, 0.001254, 0.001234, 0.001651, 0.001267, 0.001218, 0.001446, 0.001416, 0.001321, 0.001296, 0.001326, 0.001262, 0.001094, 0.001230],
        [0.057760, 0.070143, 0.111049, 0.209733, 0.371515, 0.623368, 0.879793, 1.000000, 0.998544, 0.961451, 0.921342, 0.807541, 0.598622, 0.428438, 0.387101, 0.491013, 0.576704, 0.378317, 0.168737, 0.139987, 0.272250, 0.383591, 0.264232, 0.202518, 0.211703, 0.133452, 0.056328, 0.037195, 0.056088, 0.114385, 0.145356, 0.200631, 0.152631, 0.066458, 0.029678, 0.042297, 0.031065, 0.015469, 0.008685, 0.008824, 0.012647, 0.012428, 0.010995, 0.007404, 0.005732, 0.004321, 0.004465, 0.003983, 0.004078, 0.003748, 0.003588, 0.003321, 0.003364, 0.003658, 0.003670, 0.003028, 0.003594, 0.003621, 0.003372, 0.002999, 0.003943, 0.003615, 0.003587, 0.003402],
        [0.057760, 0.070143, 0.111049, 0.209733, 0.371515, 0.623368, 0.879793, 1.000000, 0.998544, 0.961451, 0.921342, 0.807541, 0.598622, 0.428438, 0.387101, 0.491013, 0.576704, 0.378317, 0.168737, 0.139987, 0.272250, 0.383591, 0.264232, 0.202518, 0.211703, 0.133452, 0.056328, 0.037195, 0.056088, 0.114385, 0.145356, 0.200631, 0.152631, 0.066458, 0.029678, 0.042297, 0.031065, 0.015469, 0.008685, 0.008824, 0.012647, 0.012428, 0.010995, 0.007404, 0.005732, 0.004321, 0.004465, 0.003983, 0.004078, 0.003748, 0.003588, 0.003321, 0.003364, 0.003658, 0.003670, 0.003028, 0.003594, 0.003621, 0.003372, 0.002999, 0.003943, 0.003615, 0.003587, 0.003402],
        [0.059197, 0.071537, 0.112732, 0.214944, 0.391146, 0.680514, 0.962465, 1.000000, 0.793555, 0.551947, 0.430430, 0.424499, 0.491749, 0.507813, 0.375036, 0.206363, 0.125736, 0.129625, 0.205971, 0.302933, 0.344559, 0.369817, 0.320044, 0.137185, 0.043112, 0.032458, 0.037595, 0.036753, 0.054186, 0.053944, 0.047344, 0.082054, 0.106412, 0.094283, 0.036698, 0.034391, 0.030588, 0.015015, 0.008264, 0.011692, 0.011046, 0.006501, 0.005299, 0.006061, 0.004098, 0.004697, 0.003511, 0.003600, 0.003502, 0.004092, 0.003736, 0.004019, 0.003610, 0.003327, 0.003442, 0.003962, 0.004447, 0.003280, 0.002958, 0.003495, 0.003471, 0.003125, 0.003488, 0.003091],
        [0.059197, 0.071537, 0.112732, 0.214944, 0.391146, 0.680514, 0.962465, 1.000000, 0.793555, 0.551947, 0.430430, 0.424499, 0.491749, 0.507813, 0.375036, 0.206363, 0.125736, 0.129625, 0.205971, 0.302933, 0.344559, 0.369817, 0.320044, 0.137185, 0.043112, 0.032458, 0.037595, 0.036753, 0.054186, 0.053944, 0.047344, 0.082054, 0.106412, 0.094283, 0.036698, 0.034391, 0.030588, 0.015015, 0.008264, 0.011692, 0.011046, 0.006501, 0.005299, 0.006061, 0.004098, 0.004697, 0.003511, 0.003600, 0.003502, 0.004092, 0.003736, 0.004019, 0.003610, 0.003327, 0.003442, 0.003962, 0.004447, 0.003280, 0.002958, 0.003495, 0.003471, 0.003125, 0.003488, 0.003091],
        [0.059197, 0.071537, 0.112732, 0.214944, 0.391146, 0.680514, 0.962465, 1.000000, 0.793555, 0.551947, 0.430430, 0.424499, 0.491749, 0.507813, 0.375036, 0.206363, 0.125736, 0.129625, 0.205971, 0.302933, 0.344559, 0.369817, 0.320044, 0.137185, 0.043112, 0.032458, 0.037595, 0.036753, 0.054186, 0.053944, 0.047344, 0.082054, 0.106412, 0.094283, 0.036698, 0.034391, 0.030588, 0.015015, 0.008264, 0.011692, 0.011046, 0.006501, 0.005299, 0.006061, 0.004098, 0.004697, 0.003511, 0.003600, 0.003502, 0.004092, 0.003736, 0.004019, 0.003610, 0.003327, 0.003442, 0.003962, 0.004447, 0.003280, 0.002958, 0.003495, 0.003471, 0.003125, 0.003488, 0.003091],
        [0.107165, 0.117871, 0.149029, 0.213990, 0.311562, 0.474700, 0.700842, 0.905507, 1.000000, 0.926329, 0.764523, 0.618510, 0.554742, 0.594682, 0.734247, 0.902240, 0.901621, 0.642164, 0.337862, 0.168343, 0.116938, 0.142597, 0.262530, 0.462666, 0.522250, 0.387296, 0.243134, 0.149902, 0.101952, 0.088117, 0.070375, 0.049861, 0.055398, 0.084576, 0.135593, 0.092877, 0.090524, 0.118337, 0.149442, 0.143672, 0.057895, 0.044576, 0.030462, 0.019298, 0.017099, 0.015661, 0.019531, 0.014257, 0.011695, 0.011132, 0.014223, 0.006935, 0.007160, 0.006591, 0.006550, 0.005547, 0.005084, 0.005552, 0.006231, 0.005231, 0.006157, 0.005406, 0.005711, 0.004962],
        [0.107165, 0.117871, 0.149029, 0.213990, 0.311562, 0.474700, 0.700842, 0.905507, 1.000000, 0.926329, 0.764523, 0.618510, 0.554742, 0.594682, 0.734247, 0.902240, 0.901621, 0.642164, 0.337862, 0.168343, 0.116938, 0.142597, 0.262530, 0.462666, 0.522250, 0.387296, 0.243134, 0.149902, 0.101952, 0.088117, 0.070375, 0.049861, 0.055398, 0.084576, 0.135593, 0.092877, 0.090524, 0.118337, 0.149442, 0.143672, 0.057895, 0.044576, 0.030462, 0.019298, 0.017099, 0.015661, 0.019531, 0.014257, 0.011695, 0.011132, 0.014223, 0.006935, 0.007160, 0.006591, 0.006550, 0.005547, 0.005084, 0.005552, 0.006231, 0.005231, 0.006157, 0.005406, 0.005711, 0.004962],
        [0.097337, 0.104709, 0.125695, 0.168380, 0.231881, 0.342011, 0.514766, 0.721180, 0.917327, 1.000000, 0.918976, 0.734908, 0.551756, 0.441248, 0.401799, 0.418599, 0.447529, 0.409916, 0.286098, 0.167938, 0.117346, 0.137084, 0.246175, 0.395938, 0.360769, 0.219762, 0.152669, 0.131123, 0.089799, 0.056519, 0.049266, 0.042405, 0.043656, 0.081837, 0.095769, 0.082894, 0.083747, 0.075948, 0.100552, 0.086299, 0.104807, 0.056198, 0.029868, 0.028314, 0.020871, 0.015804, 0.016798, 0.016886, 0.012802, 0.009391, 0.009460, 0.007213, 0.008009, 0.007657, 0.005898, 0.006226, 0.005826, 0.006369, 0.007085, 0.006459, 0.006764, 0.006064, 0.006155, 0.005278],
        [0.097337, 0.104709, 0.125695, 0.168380, 0.231881, 0.342011, 0.514766, 0.721180, 0.917327, 1.000000, 0.918976, 0.734908, 0.551756, 0.441248, 0.401799, 0.418599, 0.447529, 0.409916, 0.286098, 0.167938, 0.117346, 0.137084, 0.246175, 0.395938, 0.360769, 0.219762, 0.152669, 0.131123, 0.089799, 0.056519, 0.049266, 0.042405, 0.043656, 0.081837, 0.095769, 0.082894, 0.083747, 0.075948, 0.100552, 0.086299, 0.104807, 0.056198, 0.029868, 0.028314, 0.020871, 0.015804, 0.016798, 0.016886, 0.012802, 0.009391, 0.009460, 0.007213, 0.008009, 0.007657, 0.005898, 0.006226, 0.005826, 0.006369, 0.007085, 0.006459, 0.006764, 0.006064, 0.006155, 0.005278],
        [0.209435, 0.217905, 0.240686, 0.283076, 0.339349, 0.425988, 0.549184, 0.691706, 0.844606, 0.964640, 1.000000, 0.938701, 0.801142, 0.643841, 0.495007, 0.372623, 0.280682, 0.215834, 0.176825, 0.164764, 0.187625, 0.260204, 0.387997, 0.501643, 0.462691, 0.309734, 0.183810, 0.123261, 0.097794, 0.082043, 0.070219, 0.066339, 0.070211, 0.076339, 0.081026, 0.080633, 0.077326, 0.091396, 0.095661, 0.076436, 0.080341, 0.078296, 0.105777, 0.056286, 0.029505, 0.023837, 0.029991, 0.024184, 0.017082, 0.018352, 0.011740, 0.008721, 0.011384, 0.012205, 0.009651, 0.007363, 0.007668, 0.010044, 0.006911, 0.007900, 0.009247, 0.009470, 0.009371, 0.007104],
        [0.209435, 0.217905, 0.240686, 0.283076, 0.339349, 0.425988, 0.549184, 0.691706, 0.844606, 0.964640, 1.000000, 0.938701, 0.801142, 0.643841, 0.495007, 0.372623, 0.280682, 0.215834, 0.176825, 0.164764, 0.187625, 0.260204, 0.387997, 0.501643, 0.462691, 0.309734, 0.183810, 0.123261, 0.097794, 0.082043, 0.070219, 0.066339, 0.070211, 0.076339, 0.081026, 0.080633, 0.077326, 0.091396, 0.095661, 0.076436, 0.080341, 0.078296, 0.105777, 0.056286, 0.029505, 0.023837, 0.029991, 0.024184, 0.017082, 0.018352, 0.011740, 0.008721, 0.011384, 0.012205, 0.009651, 0.007363, 0.007668, 0.010044, 0.006911, 0.007900, 0.009247, 0.009470, 0.009371, 0.007104],
        [0.209435, 0.217905, 0.240686, 0.283076, 0.339349, 0.425988, 0.549184, 0.691706, 0.844606, 0.964640, 1.000000, 0.938701, 0.801142, 0.643841, 0.495007, 0.372623, 0.280682, 0.215834, 0.176825, 0.164764, 0.187625, 0.260204, 0.387997, 0.501643, 0.462691, 0.309734, 0.183810, 0.123261, 0.097794, 0.082043, 0.070219, 0.066339, 0.070211, 0.076339, 0.081026, 0.080633, 0.077326, 0.091396, 0.095661, 0.076436, 0.080341, 0.078296, 0.105777, 0.056286, 0.029505, 0.023837, 0.029991, 0.024184, 0.017082, 0.018352, 0.011740, 0.008721, 0.011384, 0.012205, 0.009651, 0.007363, 0.007668, 0.010044, 0.006911, 0.007900, 0.009247, 0.009470, 0.009371, 0.007104],
        [0.280785, 0.289138, 0.311258, 0.351427, 0.403098, 0.480026, 0.586194, 0.707018, 0.838328, 0.949759, 1.000000, 0.976617, 0.889606, 0.782941, 0.689491, 0.635642, 0.634549, 0.680976, 0.743772, 0.757646, 0.668175, 0.509041, 0.367562, 0.292687, 0.294983, 0.360275, 0.441312, 0.451760, 0.388996, 0.333635, 0.298473, 0.236678, 0.158655, 0.108723, 0.080936, 0.057721, 0.052670, 0.077687, 0.088938, 0.072472, 0.103957, 0.138159, 0.090182, 0.058159, 0.049390, 0.046506, 0.026745, 0.027575, 0.030699, 0.027862, 0.031985, 0.032755, 0.030893, 0.033279, 0.015752, 0.015758, 0.014369, 0.017606, 0.015592, 0.013182, 0.013938, 0.014689, 0.012504, 0.010471],
        [0.280785, 0.289138, 0.311258, 0.351427, 0.403098, 0.480026, 0.586194, 0.707018, 0.838328, 0.949759, 1.000000, 0.976617, 0.889606, 0.782941, 0.689491, 0.635642, 0.634549, 0.680976, 0.743772, 0.757646, 0.668175, 0.509041, 0.367562, 0.292687, 0.294983, 0.360275, 0.441312, 0.451760, 0.388996, 0.333635, 0.298473, 0.236678, 0.158655, 0.108723, 0.080936, 0.057721, 0.052670, 0.077687, 0.088938, 0.072472, 0.103957, 0.138159, 0.090182, 0.058159, 0.049390, 0.046506, 0.026745, 0.027575, 0.030699, 0.027862, 0.031985, 0.032755, 0.030893, 0.033279, 0.015752, 0.015758, 0.014369, 0.017606, 0.015592, 0.013182, 0.013938, 0.014689, 0.012504, 0.010471],
        [0.190408, 0.194117, 0.203890, 0.221548, 0.244263, 0.278610, 0.328311, 0.391053, 0.474877, 0.580152, 0.692741, 0.810040, 0.914265, 0.980483, 1.000000, 0.964893, 0.875157, 0.742944, 0.588280, 0.437447, 0.314585, 0.231686, 0.190204, 0.187099, 0.222733, 0.286717, 0.335447, 0.312640, 0.245349, 0.203833, 0.199775, 0.187427, 0.133544, 0.087395, 0.081800, 0.098174, 0.093606, 0.084582, 0.088943, 0.075093, 0.081738, 0.118011, 0.111936, 0.147112, 0.097303, 0.073920, 0.076525, 0.058572, 0.055340, 0.069298, 0.051016, 0.054013, 0.059091, 0.046555, 0.043331, 0.043703, 0.033695, 0.045599, 0.041310, 0.038505, 0.033817, 0.032142, 0.036487, 0.031773],
        [0.190408, 0.194117, 0.203890, 0.221548, 0.244263, 0.278610, 0.328311, 0.391053, 0.474877, 0.580152, 0.692741, 0.810040, 0.914265, 0.980483, 1.000000, 0.964893, 0.875157, 0.742944, 0.588280, 0.437447, 0.314585, 0.231686, 0.190204, 0.187099, 0.222733, 0.286717, 0.335447, 0.312640, 0.245349, 0.203833, 0.199775, 0.187427, 0.133544, 0.087395, 0.081800, 0.098174, 0.093606, 0.084582, 0.088943, 0.075093, 0.081738, 0.118011, 0.111936, 0.147112, 0.097303, 0.073920, 0.076525, 0.058572, 0.055340, 0.069298, 0.051016, 0.054013, 0.059091, 0.046555, 0.043331, 0.043703, 0.033695, 0.045599, 0.041310, 0.038505, 0.033817, 0.032142, 0.036487, 0.031773],
        [0.190408, 0.194117, 0.203890, 0.221548, 0.244263, 0.278610, 0.328311, 0.391053, 0.474877, 0.580152, 0.692741, 0.810040, 0.914265, 0.980483, 1.000000, 0.964893, 0.875157, 0.742944, 0.588280, 0.437447, 0.314585, 0.231686, 0.190204, 0.187099, 0.222733, 0.286717, 0.335447, 0.312640, 0.245349, 0.203833, 0.199775, 0.187427, 0.133544, 0.087395, 0.081800, 0.098174, 0.093606, 0.084582, 0.088943, 0.075093, 0.081738, 0.118011, 0.111936, 0.147112, 0.097303, 0.073920, 0.076525, 0.058572, 0.055340, 0.069298, 0.051016, 0.054013, 0.059091, 0.046555, 0.043331, 0.043703, 0.033695, 0.045599, 0.041310, 0.038505, 0.033817, 0.032142, 0.036487, 0.031773],
        [0.287891, 0.292246, 0.303650, 0.324048, 0.349912, 0.388316, 0.442667, 0.509533, 0.596187, 0.700965, 0.807132, 0.907757, 0.980197, 1.000000, 0.959687, 0.864012, 0.733123, 0.595576, 0.474194, 0.379092, 0.310821, 0.263460, 0.230596, 0.206008, 0.188840, 0.180353, 0.184220, 0.204525, 0.236869, 0.256060, 0.231111, 0.169286, 0.117119, 0.094122, 0.093429, 0.096690, 0.087442, 0.072870, 0.062604, 0.051581, 0.042135, 0.044299, 0.049808, 0.047626, 0.054433, 0.056883, 0.042195, 0.035833, 0.034924, 0.042144, 0.033701, 0.034705, 0.025853, 0.026877, 0.034696, 0.030721, 0.032378, 0.033019, 0.031438, 0.024779, 0.025422, 0.024324, 0.027785, 0.021256],
        [0.287891, 0.292246, 0.303650, 0.324048, 0.349912, 0.388316, 0.442667, 0.509533, 0.596187, 0.700965, 0.807132, 0.907757, 0.980197, 1.000000, 0.959687, 0.864012, 0.733123, 0.595576, 0.474194, 0.379092, 0.310821, 0.263460, 0.230596, 0.206008, 0.188840, 0.180353, 0.184220, 0.204525, 0.236869, 0.256060, 0.231111, 0.169286, 0.117119, 0.094122, 0.093429, 0.096690, 0.087442, 0.072870, 0.062604, 0.051581, 0.042135, 0.044299, 0.049808, 0.047626, 0.054433, 0.056883, 0.042195, 0.035833, 0.034924, 0.042144, 0.033701, 0.034705, 0.025853, 0.026877, 0.034696, 0.030721, 0.032378, 0.033019, 0.031438, 0.024779, 0.025422, 0.024324, 0.027785, 0.021256],
        [0.141805, 0.144554, 0.151835, 0.165110, 0.182441, 0.209223, 0.249228, 0.301997, 0.376836, 0.478271, 0.597139, 0.734438, 0.870189, 0.966066, 1.000000, 0.955461, 0.840386, 0.689497, 0.541524, 0.421830, 0.339004, 0.288806, 0.263454, 0.252722, 0.246335, 0.233769, 0.210058, 0.179876, 0.153045, 0.136014, 0.126923, 0.119456, 0.108932, 0.097211, 0.090317, 0.089977, 0.088542, 0.077779, 0.062062, 0.048504, 0.037328, 0.031054, 0.033191, 0.039037, 0.043400, 0.054518, 0.050869, 0.035956, 0.041982, 0.037922, 0.039041, 0.034539, 0.025884, 0.024935, 0.032784, 0.030923, 0.039042, 0.029845, 0.026351, 0.024657, 0.025990, 0.025014, 0.024700, 0.026812],
        [0.141805, 0.144554, 0.151835, 0.165110, 0.182441, 0.209223, 0.249228, 0.301997, 0.376836, 0.478271, 0.597139, 0.734438, 0.870189, 0.966066, 1.000000, 0.955461, 0.840386, 0.689497, 0.541524, 0.421830, 0.339004, 0.288806, 0.263454, 0.252722, 0.246335, 0.233769, 0.210058, 0.179876, 0.153045, 0.136014, 0.126923, 0.119456, 0.108932, 0.097211, 0.090317, 0.089977, 0.088542, 0.077779, 0.062062, 0.048504, 0.037328, 0.031054, 0.033191, 0.039037, 0.043400, 0.054518, 0.050869, 0.035956, 0.041982, 0.037922, 0.039041, 0.034539, 0.025884, 0.024935, 0.032784, 0.030923, 0.039042, 0.029845, 0.026351, 0.024657, 0.025990, 0.025014, 0.024700, 0.026812],
        [0.280702, 0.283787, 0.291842, 0.306195, 0.324315, 0.351144, 0.389169, 0.436442, 0.499406, 0.579845, 0.669810, 0.771481, 0.874163, 0.954757, 1.000000, 0.992240, 0.923002, 0.803817, 0.659582, 0.519129, 0.403130, 0.319054, 0.266309, 0.239106, 0.234200, 0.245729, 0.266253, 0.283694, 0.284705, 0.265925, 0.235721, 0.205416, 0.182161, 0.163164, 0.144267, 0.126425, 0.114211, 0.106217, 0.091406, 0.064566, 0.041191, 0.034349, 0.042946, 0.055473, 0.056741, 0.057340, 0.060279, 0.053866, 0.054286, 0.056738, 0.042019, 0.037926, 0.035377, 0.033231, 0.041131, 0.040841, 0.043766, 0.042353, 0.035648, 0.032239, 0.023517, 0.028068, 0.027707, 0.026060],
        [0.280702, 0.283787, 0.291842, 0.306195, 0.324315, 0.351144, 0.389169, 0.436442, 0.499406, 0.579845, 0.669810, 0.771481, 0.874163, 0.954757, 1.000000, 0.992240, 0.923002, 0.803817, 0.659582, 0.519129, 0.403130, 0.319054, 0.266309, 0.239106, 0.234200, 0.245729, 0.266253, 0.283694, 0.284705, 0.265925, 0.235721, 0.205416, 0.182161, 0.163164, 0.144267, 0.126425, 0.114211, 0.106217, 0.091406, 0.064566, 0.041191, 0.034349, 0.042946, 0.055473, 0.056741, 0.057340, 0.060279, 0.053866, 0.054286, 0.056738, 0.042019, 0.037926, 0.035377, 0.033231, 0.041131, 0.040841, 0.043766, 0.042353, 0.035648, 0.032239, 0.023517, 0.028068, 0.027707, 0.026060],
        [0.280702, 0.283787, 0.291842, 0.306195, 0.324315, 0.351144, 0.389169, 0.436442, 0.499406, 0.579845, 0.669810, 0.771481, 0.874163, 0.954757, 1.000000, 0.992240, 0.923002, 0.803817, 0.659582, 0.519129, 0.403130, 0.319054, 0.266309, 0.239106, 0.234200, 0.245729, 0.266253, 0.283694, 0.284705, 0.265925, 0.235721, 0.205416, 0.182161, 0.163164, 0.144267, 0.126425, 0.114211, 0.106217, 0.091406, 0.064566, 0.041191, 0.034349, 0.042946, 0.055473, 0.056741, 0.057340, 0.060279, 0.053866, 0.054286, 0.056738, 0.042019, 0.037926, 0.035377, 0.033231, 0.041131, 0.040841, 0.043766, 0.042353, 0.035648, 0.032239, 0.023517, 0.028068, 0.027707, 0.026060],
        [0.389360, 0.391347, 0.396499, 0.405570, 0.416834, 0.433172, 0.455787, 0.483232, 0.519059, 0.564435, 0.615859, 0.677117, 0.746861, 0.816781, 0.886224, 0.947053, 0.988342, 1.000000, 0.974229, 0.911304, 0.818545, 0.710148, 0.601451, 0.501256, 0.421863, 0.365311, 0.328469, 0.308981, 0.301933, 0.299721, 0.292979, 0.273712, 0.242229, 0.205245, 0.171535, 0.147517, 0.133977, 0.126696, 0.119573, 0.108087, 0.092919, 0.079578, 0.073049, 0.076037, 0.088297, 0.101104, 0.099547, 0.085707, 0.078408, 0.083550, 0.083399, 0.066396, 0.054535, 0.060942, 0.069585, 0.065694, 0.066095, 0.079239, 0.070036, 0.053468, 0.057254, 0.053840, 0.047265, 0.045223],
        [0.389360, 0.391347, 0.396499, 0.405570, 0.416834, 0.433172, 0.455787, 0.483232, 0.519059, 0.564435, 0.615859, 0.677117, 0.746861, 0.816781, 0.886224, 0.947053, 0.988342, 1.000000, 0.974229, 0.911304, 0.818545, 0.710148, 0.601451, 0.501256, 0.421863, 0.365311, 0.328469, 0.308981, 0.301933, 0.299721, 0.292979, 0.273712, 0.242229, 0.205245, 0.171535, 0.147517, 0.133977, 0.126696, 0.119573, 0.108087, 0.092919, 0.079578, 0.073049, 0.076037, 0.088297, 0.101104, 0.099547, 0.085707, 0.078408, 0.083550, 0.083399, 0.066396, 0.054535, 0.060942, 0.069585, 0.065694, 0.066095, 0.079239, 0.070036, 0.053468, 0.057254, 0.053840, 0.047265, 0.045223],
        [0.664047, 0.665659, 0.669818, 0.677069, 0.685942, 0.698563, 0.715587, 0.735589, 0.760675, 0.790970, 0.823457, 0.859777, 0.898247, 0.933717, 0.965464, 0.989268, 1.000000, 0.993528, 0.966774, 0.920166, 0.856908, 0.783478, 0.707515, 0.633596, 0.570894, 0.522520, 0.487411, 0.464149, 0.447833, 0.431122, 0.405485, 0.365978, 0.318526, 0.272278, 0.236239, 0.215775, 0.208219, 0.202246, 0.183494, 0.149229, 0.114735, 0.096795, 0.098782, 0.111938, 0.114982, 0.100923, 0.093113, 0.105897, 0.119649, 0.108534, 0.099707, 0.109973, 0.103283, 0.082448, 0.083378, 0.091965, 0.097188, 0.106396, 0.093108, 0.075247, 0.072277, 0.067091, 0.066776, 0.057793],
        [0.664047, 0.665659, 0.669818, 0.677069, 0.685942, 0.698563, 0.715587, 0.735589, 0.760675, 0.790970, 0.823457, 0.859777, 0.898247, 0.933717, 0.965464, 0.989268, 1.000000, 0.993528, 0.966774, 0.920166, 0.856908, 0.783478, 0.707515, 0.633596, 0.570894, 0.522520, 0.487411, 0.464149, 0.447833, 0.431122, 0.405485, 0.365978, 0.318526, 0.272278, 0.236239, 0.215775, 0.208219, 0.202246, 0.183494, 0.149229, 0.114735, 0.096795, 0.098782, 0.111938, 0.114982, 0.100923, 0.093113, 0.105897, 0.119649, 0.108534, 0.099707, 0.109973, 0.103283, 0.082448, 0.083378, 0.091965, 0.097188, 0.106396, 0.093108, 0.075247, 0.072277, 0.067091, 0.066776, 0.057793],
        [0.664047, 0.665659, 0.669818, 0.677069, 0.685942, 0.698563, 0.715587, 0.735589, 0.760675, 0.790970, 0.823457, 0.859777, 0.898247, 0.933717, 0.965464, 0.989268, 1.000000, 0.993528, 0.966774, 0.920166, 0.856908, 0.783478, 0.707515, 0.633596, 0.570894, 0.522520, 0.487411, 0.464149, 0.447833, 0.431122, 0.405485, 0.365978, 0.318526, 0.272278, 0.236239, 0.215775, 0.208219, 0.202246, 0.183494, 0.149229, 0.114735, 0.096795, 0.098782, 0.111938, 0.114982, 0.100923, 0.093113, 0.105897, 0.119649, 0.108534, 0.099707, 0.109973, 0.103283, 0.082448, 0.083378, 0.091965, 0.097188, 0.106396, 0.093108, 0.075247, 0.072277, 0.067091, 0.066776, 0.057793],
        [1.000000, 0.999630, 0.998668, 0.996962, 0.994824, 0.991682, 0.987253, 0.981748, 0.974329, 0.964528, 0.952785, 0.937695, 0.918633, 0.896550, 0.869531, 0.837155, 0.799094, 0.755520, 0.706956, 0.654541, 0.599871, 0.544897, 0.491794, 0.440655, 0.395649, 0.358103, 0.327654, 0.305226, 0.290985, 0.284294, 0.283094, 0.284547, 0.284676, 0.279492, 0.266484, 0.246341, 0.223708, 0.203209, 0.187883, 0.177597, 0.169076, 0.159248, 0.148516, 0.141416, 0.142616, 0.150605, 0.154895, 0.147519, 0.137738, 0.138848, 0.143414, 0.132176, 0.118455, 0.125928, 0.132650, 0.117452, 0.122549, 0.135724, 0.113482, 0.099218, 0.080548, 0.079162, 0.087331, 0.078021],
        [1.000000, 0.999630, 0.998668, 0.996962, 0.994824, 0.991682, 0.987253, 0.981748, 0.974329, 0.964528, 0.952785, 0.937695, 0.918633, 0.896550, 0.869531, 0.837155, 0.799094, 0.755520, 0.706956, 0.654541, 0.599871, 0.544897, 0.491794, 0.440655, 0.395649, 0.358103, 0.327654, 0.305226, 0.290985, 0.284294, 0.283094, 0.284547, 0.284676, 0.279492, 0.266484, 0.246341, 0.223708, 0.203209, 0.187883, 0.177597, 0.169076, 0.159248, 0.148516, 0.141416, 0.142616, 0.150605, 0.154895, 0.147519, 0.137738, 0.138848, 0.143414, 0.132176, 0.118455, 0.125928, 0.132650, 0.117452, 0.122549, 0.135724, 0.113482, 0.099218, 0.080548, 0.079162, 0.087331, 0.078021],
        [1.000000, 0.998926, 0.996160, 0.991343, 0.985460, 0.977107, 0.965853, 0.952620, 0.935943, 0.915564, 0.893189, 0.867083, 0.837345, 0.806426, 0.772570, 0.736270, 0.698157, 0.658953, 0.619482, 0.580503, 0.542806, 0.506968, 0.473527, 0.441564, 0.412687, 0.386836, 0.362924, 0.340812, 0.320108, 0.300773, 0.281564, 0.261384, 0.240871, 0.219396, 0.196700, 0.173437, 0.151004, 0.130077, 0.111741, 0.097030, 0.086388, 0.080374, 0.078737, 0.080756, 0.085115, 0.090159, 0.095319, 0.101424, 0.107357, 0.105834, 0.090004, 0.069151, 0.059130, 0.064928, 0.076309, 0.077627, 0.077538, 0.083563, 0.075772, 0.059313, 0.050661, 0.051918, 0.060802, 0.045720]
    ])
    freqs: np.ndarray = np.array([
           0,    4,    7,   12,   16,   20,   25,   30,   35,   41,
          47,   53,   60,   67,   74,   82,   90,   99,  108,  118,
         128,  139,  150,  162,  175,  188,  202,  217,  233,  250,
         267,  286,  306,  326,  348,  371,  396,  421,  449,  477,
         508,  540,  574,  609,  647,  687,  729,  773,  820,  869,
         922,  977, 1035, 1097, 1161, 1230, 1302, 1379, 1460, 1545,
        1635, 1730, 1830, 1936, 2048
    ])
    z = plucked_string_frequency_filter(z, note_no, LOWEST_NOTE_NO, N_FFT, N_BAND, WIN_LEN, amps, freqs, duration, sr)

    # parts
    p_vcf_a: dict[str, float] = {'A': 0, 'D': 5/freq, 'S': 0, 'R': 5/freq,
                                 'gate': gate, 'dur': duration, 'offset': 32*freq, 'depth': 512*freq}
    p_vca_a: dict[str, float] = {'A': 1/freq, 'D': 20/freq, 'S': 0, 'R': 20/freq,
                                 'gate': gate, 'dur': duration, 'offset': 0, 'depth': 1}
    za: np.ndarray = plucked_string_part(z, p_vcf_a, p_vca_a, sr)

    p_vcf_s: dict[str, float] = {'A': 0, 'D': 0.2*fbk_decay, 'S': 0, 'R': 0.2*fbk_decay,
                                 'gate': gate, 'dur': duration, 'offset': 8*freq, 'depth': 128*freq}
    p_vca_s: dict[str, float] = {'A': 1/freq, 'D': 0, 'S': 1, 'R': 0,
                                 'gate': duration, 'dur': duration, 'offset': 0, 'depth': 1}
    zs: np.ndarray = plucked_string_part(z, p_vcf_s, p_vca_s, sr)

    vca: np.ndarray = adsr(A=0, D=0, S=1, R=0.1, gate=gate, dur=duration, sr=sr)
    z = vca * (0.5 * za + 0.5 * zs)
    z = (velocity / 127) / np.max(np.abs(z)) * z

    if post_effect is not None:
        z = post_effect(z, sr=sr, **post_effect_kwargs)
    return z


def electric_bass(note_no: int, velocity: int, gate: float, duration: float, sr: int =44100) -> np.ndarray:
    vco: np.ndarray = square(np.full(int(duration*sr), calc_freq(note_no)), duty=0.125, sec=duration, sr=sr)
    vco = biquad_filter(vco, filter_type="highpass", fc=5, Q=1/np.sqrt(2), sr=sr)
    vcf: np.ndarray = 200 + 800 * adsr(A=0, D=0.2, S=0, R=0.2, gate=gate, dur=duration, sr=sr)
    vca: np.ndarray = adsr(A=0.1, D=8, S=0, R=0.1, gate=gate, dur=duration, sr=sr)
    z: np.ndarray = vca * biquad_filter(vco, filter_type="lowpass", fc=vcf, Q=1/np.sqrt(2), sr=sr)
    z = compressor(z/np.max(np.abs(z)), threshold=0.5, width=0.4, ratio=8)
    return (velocity / 127) / np.max(np.abs(z)) * z